--- 
title_meta  : Chapter 3
title       : WEEK 3, Linear regression (deadline 28.11. 23:59)
description : "This weeks exercises will focus on linear regression. You will form a few models yourself and train to interpret the results from those models. You will also learn to evaluate the assumptions of the models."
 
--- type:NormalExercise lang:r xp:100 skills:1 key:exercise3_1
## WEEK 3 STARTS HERE: Linear regression with one explanatory variable
 
In this exercise you will form a linear regression model, see the results and make some interpretations based on those. In R linear regression can be done using lm()- function, for example: lm(cardiac$dobEF~cardiac$baseEF). Before the ~ sign you can put only one variable, the outcome variable. After it you can put one or multiple explanatory variables devided by the + sign. 
 
*** =instructions
 - Form a linear regression model, in which you will have systolic blood pressure (sbp) as an outcome variable and age as an explanatory variable. Use the Cardiac-data. (Don't use the with-function this time.)

 - Interpret the results: 
   + What is the regression coefficient?
   + What is the intercept?
   + What is the variance explained?
 
*** =hint
Use formula lm(data$outcome~data$explanatory). To show the results, use summary-fucntion. 
 
*** =pre_exercise_code
```{r}
cardiac<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Cardiac.txt",header=T,row.names=1)
diabetes<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Diabetes.txt",header=TRUE,row.names=1)
```
 
*** =sample_code
```{r}
# Form the model:

# Check the results:

# Fill the following sentences with the right number:
# Regression coefficient is:
# Intercept is:
# Variance explained is:

```
 
*** =solution
```{r}
reg1<-lm(cardiac$sbp~cardiac$age)
summary(reg1)
# Fill the following sentences with the right number:
# Regression coefficient is: -0.2203
# Intercept is: 161.7502
# Variance explained is: 0.00349
```
 
*** =sct
```{r}
test_student_typed("lm(cardiac$sbp~cardiac$age)", not_typed_msg = "Make sure you have put the variables in the right order, and they are divided by the ~ sign.")
test_student_typed("summary(", not_typed_msg = "Make sure you have used the summary-function to see the results.")
test_student_typed("Regression coefficient is: -0.22", not_typed_msg = "Make sure you have typed the right regression coefficient.")
test_student_typed("Intercept is: 161.7", not_typed_msg = "Make sure you have typed the right intercept.")
test_student_typed("Variance explained is: 0.00349", not_typed_msg = "Make sure you have typed the right variance explained.")


```

--- type:NormalExercise lang:r xp:100 skills:1 key:exercise3_2
## Linear regression with multiple explanatory variables
 
In the previous exercise you made a linear regression using one explanatory variables. In this exercise you will add explanatory variables. 
 
*** =instructions
 - Form a linear regression model, in which you will have systolic blood pressure (sbp) as an outcome variable and age, sex and ejection fraction (baseEF) as an explanatory variable. Use the Cardiac-data. (Don't use the with-function this time.)
 Interpret the results: 
   - What is the regression coefficient for age?
   - What is the regression coefficient for gender?
   - What is the regression coefficient for ejection fraction?
   - What is the intercept?
   - What is the variance explained?
 
*** =hint
Use formula lm(data$outcome~data$explanatory1+data$explanatory2+ etc).  
 
*** =pre_exercise_code
```{r}
cardiac<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Cardiac.txt",header=T,row.names=1)
diabetes<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Diabetes.txt",header=TRUE,row.names=1)
```
 
*** =sample_code
```{r}
# Form the model

# Check the results

# Fill the following sentences with the right numbers:
# Regression coefficient for age is: 
# Regression coefficient for gender is: 
# Regression coefficient for ejection fraction is: 
# Intercept is: 
# Variance explained is: 
 
```
 
*** =solution
```{r}
reg<-lm(cardiac$sbp~cardiac$age+cardiac$gender+cardiac$baseEF)
summary(reg)
# Regression coefficient for age is: -0.2219

# Regression coefficient for gender is: -0.1973

# Regression coefficient for ejection fraction is: 0.4314

# Intercept is: 137.9916

# Variance explained is: 0.001469

```
 
*** =sct
```{r}
test_student_typed("lm(cardiac$sbp~cardiac$age+cardiac$gender+cardiac$baseEF)", not_typed_msg = "Make sure you have put the variables in the right order, and they are divided by the + sign.")
test_student_typed("summary(", not_typed_msg = "Make sure you have used the summary-function to see the results.")
test_student_typed("Regression coefficient for age is: -0.22", not_typed_msg = "Make sure you have typed the right regression coefficient for age.")
test_student_typed("Regression coefficient for gender is: -0.1973", not_typed_msg = "Make sure you have typed the right regression coefficient for gender.")
test_student_typed("Regression coefficient for ejection fraction is: 0.43", not_typed_msg = "Make sure you have typed the right regression coefficient for ejection fraction.")
test_student_typed("Intercept is: 137.9", not_typed_msg = "Make sure you have typed the right intercept.")
test_student_typed("Variance explained is: 0.01", not_typed_msg = "Make sure you have typed the right variance explained.")

```

--- type:NormalExercise lang:r xp:100 skills:1 key:exercise3_3
## Checking the assumptions for your model graphically
 
Now you know how to form linear regression models and check their results. In this exercise you will learn how to check how your model fits the assumptions (normality). You can do this for example creating a Q-Q plot from your model using qqnorm(studred(model))- command, or plotting a histogram from the residuals of your model typing hist(studres(model)).
 
*** =instructions
The models you created in the previous exercises are named reg1 and reg2, accordingl with the following commands:
 - reg1<-lm(cardiac$sbp~cardiac$age)
 - reg2<-lm(cardiac$sbp~cardiac$age+cardiac$gender+cardiac$baseEF)
You don't need to run these by yourself anymore!
 - Create Q-Q plot from your 'one explanatory variable' model, reg1, and add the unity line by typing abline(0,1) after your plotting command. How does it look?
 - Plot the histogram from the residuals of that same model. 
 - Create Q-Q plot from your 'multiple explanatory variables' model, reg2, and add the unity line. How does it look?
 - Plot the histogram from the residuals of that same model.
 - Plot histogram from your outcome variable, sbp.
*** =hint
  
 
*** =pre_exercise_code
```{r}
cardiac<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Cardiac.txt",header=T,row.names=1)
diabetes<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Diabetes.txt",header=TRUE,row.names=1)
reg1<-lm(cardiac$sbp~cardiac$age)
reg2<-lm(cardiac$sbp~cardiac$age+cardiac$gender+cardiac$baseEF)
library(MASS)
```
 
*** =sample_code
```{r}
## Create Q-Q plot from your 'one explanatory variable' model, reg1 

## Plot histogram from that same model's residuals

## Create Q-Q plot from your 'multiple explanatory variables' model, reg2 

## Plot histogram from that same model's residuals

## Now plot histogram from your outcome- variable, cardiac$sbp, and compare it with the histograms of residuals. What can you see?
 
```
 
*** =solution
```{r}
qqnorm(studres(reg1))
abline(0,1)
hist(studres(reg1))
qqnorm(studres(reg2))
abline(0,1)
hist(studres(reg2))
hist(cardiac$sbp)
```
 
*** =sct
```{r}

```

--- type:MultipleChoiceExercise lang:r xp:100 skills:1 key:exercise3_4
## Comparing the variance explained
 
You've learned a lot about linear regression today! There is still lot to be learned. Next we will compare the varinces explained by our one variable model and our multiple variables model.Once again, you can refer to your models with reg1 and reg2. Check the variance explained (adjusted R squared) from both of these models by typing  summary(reg1) and summary(reg2) to the console. 
Which one of these models explains the blood pressure better?
*** =instructions
*** =instructions
- reg1
- reg2
 
*** =hint
  - Which one's adjusted R squared is bigger? 
 
*** =pre_exercise_code
```{r}
cardiac<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Cardiac.txt",header=T,row.names=1)
diabetes<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Diabetes.txt",header=TRUE,row.names=1)
reg1<-lm(cardiac$sbp~cardiac$age)
reg2<-lm(cardiac$sbp~cardiac$age+cardiac$gender+cardiac$baseEF)
library(MASS)
```
 
*** =sample_code
```{r}
## Check the variance explained (adjusted R squared) from both of these models

```
 
*** =solution
Reg1
 
*** =sct
msg1 <- "Perfect! This shoul have been easy one..."
msg2 <- "Not good, try again!"

test_mc(1, feedback_msgs = c(msg1, msg2))

--- type:MultipleChoiceExercise lang:r xp:100 skills:1 key:exercise3_5
## To keep or not to keep?
 
Next we will look our multiple variable model, reg2. Check out that model's summary once again. Based on every explanatory variables effects p-value, 
which variable(s) you would keep in the model ?
*** =instructions
*** =instructions
- Age
- Gender
- BaseEF

*** =hint
  - You should choice only those variables, which p-value is <0.05
 
*** =pre_exercise_code
```{r}
cardiac<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Cardiac.txt",header=T,row.names=1)
diabetes<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Diabetes.txt",header=TRUE,row.names=1)
reg2<-lm(cardiac$sbp~cardiac$age+cardiac$gender+cardiac$baseEF)

```
 
*** =sample_code
```{r}
## Check out the results from reg2

```
 
*** =solution

baseEF
*** =sct
msg1 <- "Perfect! This shoul have been easy one..."
msg2 <- "Not good, try again!"
msg3 <- "Correct! BaseEF is the only significant explanatory variable for systolic blood pressure. Age and gender still should not in real wordl never be left from the model!"


test_mc(3, feedback_msgs = c(msg1, msg2, msg3))

--- type:NormalExercise lang:r xp:100 skills:1 key:exercise3_6
## Still one thing left to do...
 
Now you have gone through the basics of linear model. Let's apply all these information with one more model! 
 
*** =instructions
 - Form a linear model, in which you explain the ratio of total cholesterol and HDL cholesterol (ratio) by bmi, age, gender and . Use the diebetes- dataset. 
 - Check the results: intercept, regression coefficients, variance explained. 
 - Create a Q-Q plot from that model. How does it look like?

*** =hint
  
 
*** =pre_exercise_code
```{r}
cardiac<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Cardiac.txt",header=T,row.names=1)
diabetes<-read.table("https://raw.githubusercontent.com/paulabergman/intro-to-biostatistics-with-r/master/Diabetes.txt",header=TRUE,row.names=1)

library(MASS)
```
 
*** =sample_code
```{r}
## Form a linear model

## Check the results and fill the following:

## Intercept is:
## Regression coefficient for bmi is:
## Regression coefficient for age is:
## Regression coefficient for gender is:
## Regression coefficient for  is:
## Variance explained is:
 
##Create a Q-Q plot

## Which of these variables you would keep in the model? Leave thosa here: BMI, AGE, GENDER, 
```
 
*** =solution
```{r}


```
 
*** =sct
```{r}

```
